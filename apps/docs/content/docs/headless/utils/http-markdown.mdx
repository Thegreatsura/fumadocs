---
title: HTTP Markdown Negotiation
description: Serve markdown or HTML depending on the client Accept header.
---

Fumadocs Core ships a tiny http toolkit that helps you negotiate the format of
your responses using the `Accept` header. This is especially useful when you
want the same route to deliver `text/markdown` to LLM tooling while keeping the
regular HTML experience for browsers.

## Quick start

Import the helpers from `fumadocs-core/http` and plug them into your middleware
or API routes:

```ts
import {
  pickPreferredFormat,
  resolveMarkdownRedirect,
} from 'fumadocs-core/http';

const redirect = resolveMarkdownRedirect({
  headers: new Headers([['accept', 'text/markdown']]),
  pathname: '/docs/intro',
  redirectOptions: {
    target: '/llms.mdx',
    sourceBase: '/docs',
  },
});
```

By default the helpers recognise common markdown and HTML media-types. You can
override them when you need to support custom media strings:

```ts
pickPreferredFormat(request.headers, {
  markdownTypes: ['application/x-my-markdown'],
});
```

## Redirect planner

`planMarkdownRedirect` produces the canonical pathname for markdown-aware
clients. By default the middleware will rewrite to the given `target` when
markdown is preferred, and keep the original path when HTML is preferred.
`MarkdownRedirectOptions` accepts:

- `target` (required) – destination prefix, e.g. `/llms.mdx`.
- `sourceBase` – optional prefix to strip before appending the slug.
- `minSegments` – minimal slug length before the redirect triggers (default `1`).

```ts
planMarkdownRedirect({
  pathname: '/docs/getting-started',
  preferred: 'markdown',
  target: '/llms.mdx',
  sourceBase: '/docs',
});
// ➜ '/llms.mdx/getting-started'
```

## Next.js middleware helper

Need a drop-in for the App Router? Use `createMarkdownMiddleware` from
`fumadocs-core/http/middleware/next`:

```ts
// apps/docs/middleware.ts
import { createMarkdownMiddleware } from 'fumadocs-core/http/middleware/next';

export const middleware = createMarkdownMiddleware({
  resolver: {
    redirectOptions: {
      target: '/llms.mdx',
      sourceBase: '/docs',
    },
  },
});

export const config = {
  matcher: ['/docs/:path*'],
};
```

Behind the scenes the middleware uses `resolveMarkdownRedirect`, so the options
match the core helper.

## Respond with markdown automatically

Once the middleware is in place you can serve markdown by returning the raw
document with a `text/markdown` content type:

```ts
import { getLLMText } from '@/lib/get-llm-text';
import { source } from '@/lib/source';

export async function GET(_req: Request, { params }: { params: { slug: string[] } }) {
  const page = source.getPage(params.slug);
  if (!page) return new Response('Not Found', { status: 404 });

  return new Response(await getLLMText(page), {
    headers: {
      'Content-Type': 'text/markdown',
    },
  });
}
```

Clients that announce `text/markdown` or `text/plain` will receive markdown
automatically, while browsers continue to load the normal HTML page.

