---
title: HTTP Markdown Negotiation
description: Serve markdown or HTML depending on the client Accept header.
---

Fumadocs Core ships a tiny http toolkit that helps you negotiate the format of
your responses using the `Accept` header. This is especially useful when you
want the same route to deliver `text/markdown` to LLM tooling while keeping the
regular HTML experience for browsers.

## Quick start

Import the helpers from `fumadocs-core/http` and plug them into your middleware
or API routes:

```ts twoslash
import {
  pickPreferredFormat,
  planMarkdownRedirect,
  resolveMarkdownRedirect,
} from 'fumadocs-core/http';

const preferred = pickPreferredFormat(request.headers);
const redirectTo = planMarkdownRedirect({
  pathname: request.url.pathname,
  preferred,
});

// Or in a single step:
const redirect = resolveMarkdownRedirect({
  headers: request.headers,
  pathname: request.url.pathname,
});
```

By default the helpers recognise common markdown and HTML media-types. You can
override them when you need to support custom media strings:

```ts
pickPreferredFormat(request.headers, {
  markdownTypes: ['application/x-my-markdown'],
});
```

## Redirect planner

`planMarkdownRedirect` produces the canonical `pathname` for markdown-aware
clients. It appends `.mdx` when markdown is preferred and removes the suffix
when HTML is preferred. You can tweak behaviour via `MarkdownRedirectOptions`:

- `markdownExtension` (default `.mdx`)
- `minSegments` (default `2`, prevents `/docs` → `/docs.mdx`)
- `stripTrailingSlash`

```ts
planMarkdownRedirect({
  pathname: '/docs/getting-started',
  preferred: 'markdown',
  markdownExtension: '.mdx',
  minSegments: 2,
});
// ➜ '/docs/getting-started.mdx'
```

## Next.js middleware helper

Need a drop-in for the App Router? Use `createMarkdownMiddleware` from
`fumadocs-core/http/middleware/next`:

```ts
// apps/docs/middleware.ts
import { createMarkdownMiddleware } from 'fumadocs-core/http/middleware/next';

export const middleware = createMarkdownMiddleware({
  resolver: {
    redirectOptions: {
      markdownExtension: '.mdx',
    },
  },
});

export const config = {
  matcher: ['/docs/:path*'],
};
```

Behind the scenes the middleware uses `resolveMarkdownRedirect`, so the options
match the core helper.

## Respond with markdown automatically

Once the middleware is in place you can serve markdown by returning the raw
document with a `text/markdown` content type:

```ts
import { getLLMText } from '@/lib/get-llm-text';
import { source } from '@/lib/source';

export async function GET(_req: Request, { params }: { params: { slug: string[] } }) {
  const page = source.getPage(params.slug);
  if (!page) return new Response('Not Found', { status: 404 });

  return new Response(await getLLMText(page), {
    headers: {
      'Content-Type': 'text/markdown',
    },
  });
}
```

Clients that announce `text/markdown` or `text/plain` will receive markdown
automatically, while browsers continue to load the normal HTML page.

